"""
PDF to Video - Lab 07: Docker Compose
"""
import asyncio
import edge_tts
from pathlib import Path
from pdf2image import convert_from_path
from moviepy.editor import ImageClip, AudioFileClip, concatenate_videoclips

PDF_FILE = "lab07.pdf"
OUTPUT_VIDEO = "lab07-docker-compose.mp4"
VOICE = "th-TH-NiwatNeural"
RATE = "-15%"
DPI = 200

SCRIPTS = [
    """‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö... ‡πÅ‡∏•‡πá‡∏ö‡∏ó‡∏µ‡πà 7 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏î‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡∏™...
    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 3.75 ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢ ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ‡∏î‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡∏™""",
    
    """‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡πÇ‡∏Ñ‡∏•‡∏ô Advanced-RAG-Docker ‡∏£‡∏µ‡πÇ‡∏û‡∏ã‡∏¥‡∏ó‡∏≠‡∏£‡∏µ‡πà...
    ‡∏£‡∏±‡∏ô 6 ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏î‡πâ‡∏ß‡∏¢ ‡∏î‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡∏™...
    ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡πÅ‡∏£‡∏Å... ‡πÇ‡∏Ñ‡∏•‡∏ô ‡∏£‡∏µ‡πÇ‡∏û‡∏ã‡∏¥‡∏ó‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏û‡∏¥‡∏°‡∏û‡πå git clone github.com/amornpan/Advanced-RAG-Docker.git...
    ‡πÅ‡∏•‡πâ‡∏ß cd ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå...
    ‡∏£‡∏µ‡πÇ‡∏û‡∏ã‡∏¥‡∏ó‡∏≠‡∏£‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏°‡∏µ ‡∏î‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡∏™ ‡πÑ‡∏ü‡∏•‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡∏ó‡∏µ‡πà 2... ‡∏®‡∏∂‡∏Å‡∏©‡∏≤ docker-compose.yml ‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏°‡∏µ 6 ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™...
    opensearch_container ‡∏û‡∏≠‡∏£‡πå‡∏ï 9200 ‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏î‡∏≤‡∏ï‡πâ‡∏≤‡πÄ‡∏ö‡∏™...
    embedding_container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÄ‡∏≠‡πá‡∏°‡πÄ‡∏ö‡∏î‡∏î‡∏¥‡πâ‡∏á...
    search_api_container ‡∏û‡∏≠‡∏£‡πå‡∏ï 8005 ‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ä ‡πÄ‡∏≠‡∏û‡∏µ‡πÑ‡∏≠...
    backend_container ‡∏û‡∏≠‡∏£‡πå‡∏ï 8006 ‡πÄ‡∏õ‡πá‡∏ô ‡πÅ‡∏ö‡πá‡∏Ñ‡πÄ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏≠‡∏û‡∏µ‡πÑ‡∏≠...
    frontend_container ‡∏û‡∏≠‡∏£‡πå‡∏ï 8501 ‡πÄ‡∏õ‡πá‡∏ô Streamlit UI...
    ‡πÅ‡∏•‡∏∞ ollama_container ‡∏û‡∏≠‡∏£‡πå‡∏ï 11434 ‡πÄ‡∏õ‡πá‡∏ô LLM ‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡∏ó‡∏µ‡πà 3... ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏û‡∏¥‡∏°‡∏û‡πå docker-compose up -d...
    -d ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏±‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ...
    ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î ‡∏≠‡∏¥‡∏°‡πÄ‡∏°‡∏à ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡∏ó‡∏µ‡πà 4... ‡πÄ‡∏ä‡πá‡∏Ñ ‡∏™‡πÄ‡∏ï‡∏ï‡∏±‡∏™‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏û‡∏¥‡∏°‡∏û‡πå docker-compose ps...
    ‡∏ó‡∏∏‡∏Å ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á State ‡πÄ‡∏õ‡πá‡∏ô Up...
    ‡πÅ‡∏•‡∏∞ ‡∏û‡∏≠‡∏£‡πå‡∏ï ‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏°‡πá‡∏õ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡∏ó‡∏µ‡πà 5... ‡∏î‡∏π ‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏û‡∏¥‡∏°‡∏û‡πå docker-compose logs -f ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ó‡∏∏‡∏Å ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™...
    ‡∏´‡∏£‡∏∑‡∏≠ docker-compose logs -f backend_container ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß...
    ‡∏Å‡∏î Ctrl+C ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å ‡∏•‡πá‡∏≠‡∏Å ‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡∏ó‡∏µ‡πà 6... ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡πÄ‡∏õ‡∏¥‡∏î localhost:8501 ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå...
    ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô RAG ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô...
    ‡∏ó‡∏∏‡∏Å ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô ‡∏î‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå ‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Ñ ‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏ó‡∏≤‡∏™‡∏Ñ‡πå‡∏ó‡∏µ‡πà 7... ‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏û‡∏¥‡∏°‡∏û‡πå docker-compose down ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏ö ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå...
    ‡∏´‡∏£‡∏∑‡∏≠ docker-compose down -v ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö ‡πÇ‡∏ß‡∏•‡∏∏‡πà‡∏° ‡∏î‡πâ‡∏ß‡∏¢...
    ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏ß‡∏£‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏Ñ‡∏£‡∏±‡∏ö""",
    
    """‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏ö...
    ‡∏£‡∏±‡∏ô 6 ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö...
    ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ...
    ‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ docker ps...
    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï...
    ‡πÄ‡∏î‡∏î‡πÑ‡∏•‡∏ô‡πå ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå 23:59 ‡∏Ñ‡∏£‡∏±‡∏ö!""",
]

async def generate_audio(text, output_file):
    communicate = edge_tts.Communicate(text, VOICE, rate=RATE)
    await communicate.save(output_file)

async def generate_all_audio():
    Path("audio").mkdir(exist_ok=True)
    print("üé§ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á...")
    for i, script in enumerate(SCRIPTS, 1):
        await generate_audio(script, f"audio/slide_{i:02d}.mp3")
        print(f"  ‚úÖ Slide {i}/{len(SCRIPTS)}")

def convert_pdf_to_images():
    Path("images").mkdir(exist_ok=True)
    print("üñºÔ∏è ‡πÅ‡∏õ‡∏•‡∏á PDF...")
    images = convert_from_path(PDF_FILE, dpi=DPI)
    for i, img in enumerate(images, 1):
        img.save(f"images/slide_{i:02d}.png", "PNG")
    return len(images)

def create_video(num_slides):
    print("üé¨ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠...")
    clips = []
    for i in range(1, num_slides + 1):
        img, aud = f"images/slide_{i:02d}.png", f"audio/slide_{i:02d}.mp3"
        if Path(aud).exists():
            audio = AudioFileClip(aud)
            clip = ImageClip(img).set_duration(audio.duration).set_audio(audio)
        else:
            clip = ImageClip(img).set_duration(5)
        clips.append(clip)
    final = concatenate_videoclips(clips, method="compose")
    final.write_videofile(OUTPUT_VIDEO, fps=24, codec="libx264", audio_codec="aac", verbose=False, logger=None)
    final.close()
    print(f"‚úÖ {OUTPUT_VIDEO}")

async def main():
    print(f"üé¨ Lab 07: Docker Compose")
    if not Path(PDF_FILE).exists():
        print(f"‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö {PDF_FILE}")
        return
    await generate_all_audio()
    num = convert_pdf_to_images()
    create_video(min(num, len(SCRIPTS)))

if __name__ == "__main__":
    asyncio.run(main())
